name: 'Chkk Offline'
description: 'Check your Kubernetes manifests locally'
inputs:
  kubernetes-manifest:
    description: 'Kubernetes manifest to check'
    required: true
  skip-checks:
    description: 'List of checks to skip'
    required: false
    default: "default"
  run-checks:
    description: 'List of checks to run'
    required: false
    default: "default"
  args:
    description: 'Additional arguments to pass to Chkk'
    required: false

runs:
  using: "composite"
  steps:
    - run: set -xv
      shell: bash
    - run: sudo apt-get update && sudo apt-get install -y docker.io
      shell: bash
    - run: docker run -d --name chkk-engine -p 5099:8000 public.ecr.aws/i1v3p4q2/chkk-engine:v0.7
      shell: bash
    - run: curl -Lo chkk https://downloads.chkk.dev/v0.0.1/chkk-linux-amd64
      shell: bash
    - run: chmod +x chkk
      shell: bash
    - run: ${{ github.workspace }}/chkk -f ${{ inputs.kubernetes-manifest }} --endpoint http://localhost:5099 -s ${{ inputs.skip-checks }} -r ${{ inputs.run-checks }} ${{ inputs.args }}
      shell: bash
